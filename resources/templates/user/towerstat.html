<!-- /*****************************************************
 * GITADORA Info Server
 * Developed by Tae Jun Kang a.k.a Prunus Nira
 * (c) Nira 2016
 *
 * 1. This project is protected under GNU AGPL v3.0
 *    Please refer to LICENSE file on root
 * 2. Also, products and libraries used to implement
 *    this server are on USED-LIBRARIES file on root
 *****************************************************/ -->
 <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="google-signin-client_id"
      content="signin_client_id.apps.googleusercontent.com">
    <link rel="icon" href="/favicon.ico">

    <script src="/function/language.js"></script>
    <script src="/function/language/profiletowerstat.js"></script>
    <title>GITADORA Info</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom css -->
	<link href="/css/custom/header.css" rel="stylesheet">
	<link href="/css/custom/footer.css" rel="stylesheet">
	<link href="/css/custom/profile.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- Google Adsense -->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({
			google_ad_client: "ca-pub-adsense_id",
			enable_page_level_ads: true
		});
	</script>
    </head>

    <body>
        <section class="container" id="loading">
            <div class="text-center">
                <h1>LOADING... Please wait</h1>
            </div>
        </section>

        <section class="container">
            <div class="text-center">
                <h3>Tower clear status</h3>
            </div>
        </section>

        <section class='container'>
            <div class='row'>
                <div class='col-12'>
                    <a class='btn btn-primary' href='#titlesection'><script>document.write(txtTowerStat.btntitle[lang]);</script></a>
                </div>
            </div>
            <div class='row'>
                <div class='col-12'>
                    <div class='card text-center'>
                        <div class='card-header'>
                            <h4><script>document.write(txtTowerStat.towerhead[lang]);</script></h4>
                        </div>
                        <div class='card-body' id='towerlist'>
                            <tower-table v-for='t in towerlist' v-bind:t="t"></tower-table>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class='col-12'>
                    <a class='btn btn-primary' href='#top'><script>document.write(txtTowerStat.btntop[lang]);</script></a>
                </div>
            </div>
            <div class='row' id='titlesection'>
                <div class='col-12'>
                    <div class='card text-center'>
                        <div class='card-header'>
                            <h4><script>document.write(txtTowerStat.titlehead[lang]);</script></h4>
                        </div>
                        <div class='card-body' id='titlelist'>
                            <div class='row'>
                                <div class='col-12'>
                                    <script>document.write(txtTowerStat.duplicate[lang]);</script>
                                </div>
                            </div>
                            <div class='row'>
                                <title-table v-for='t in titlelist' v-bind:t="t"></title-table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class='col-12'>
                    <a class='btn btn-primary' href='#top'><script>document.write(txtTowerStat.btntop[lang]);</script></a>
                </div>
            </div>
        </section>
        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="/js/jquery-3.3.1.min.js"></script>
        <script src="/js/vue.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/function/titletxt.js"></script>
        <script src="/function/towername.js"></script>
        <script src="/function/overall.js"></script>
        <script src="https://apis.google.com/js/platform.js?onload=gsignLoad" async defer></script>
        <div style='display:none'>
            <form action='/logout' id='logout' method='post'>
            </form>
        </div>

        <template id='tower-template'>
            <div class='row'>
                <div class='col-12'>
                    <div class='card' style='padding:10px;'>
                        <div class='card-header'>
                            {{ t.tower }}
                        </div>
                        <div class='card-body'>
                            <span v-html="t.cont"></span>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <template id='title-template'>
            <div class='col-12 text-left'>
                <img class='towertitle50' v-bind:src='t.src'/>
                <span>{{ t.name }}</span>
            </div>
        </template>

        <script th:inline="javascript">
        Vue.component('tower-table', {
            template: '#tower-template',
            props: {
                t: Object
            }
        });

        Vue.component('title-table', {
            template: '#title-template',
            props: {
                t: Object
            }
        });

        var loadTitle = false;
        var loadTower = false;

        var uid = /*[[${uid}]]*/0;

        var vmTower = new Vue({
            el: '#towerlist',
            data: {
                towerlist: []
            },
            created: function() {
                var self = this;
                $.ajax('/d/profile/towerstatus/tower/'+uid)
                .done(function(data) {
                    var json = JSON.parse(data);
                    var list = json.list;
                    var tower = json.tower;

                    for(var i = 0; i < list.length; i++) {
                        var obj = {};
                        obj.tower = towerName[list[i]][lang];
                        obj.cont = "";
                        
                        for(j = 0; j < tower.length; j++) {
                            if(list[i] == tower[j].tower) {
                                obj.cont +=
                                (tower[j].floor+1)+txtTowerStat.floor[lang]+": ";
                                if(tower[j].clear == "Y") obj.cont += "Cleared";
                                else obj.cont += "Not cleared";
                                obj.cont += "<br/>";
                            }
                        }
                        if(obj.cont == "") obj.cont = txtTowerStat.nodata[lang];
                        self.towerlist.push(obj);
                    }
                    loadTower = true;
                    checkLoading();
                });
            }
        });

        var vmTitle = new Vue({
            el: '#titlelist',
            data: {
                titlelist: []
            },
            created: function() {
                var self = this;
                $.ajax('/d/profile/towerstatus/floor/'+uid)
                .done(function(data) {
                    var json = JSON.parse(data);
                    var floor = json.floor;

                    var list = new Array();
                    for(var i = 0; i < floor.length; i++) {
                        var t = titlesp[floor[i].mid];
                        if(t != null) {
                            if(t.type == 0) {
                                var obj = {};
                                obj.src = "/img/title/"+t[floor[i].ptcode].value+".png";
                                obj.name = t[floor[i].ptcode][lang];
                                self.titlelist.push(obj);
                            }
                            else if(t.type == 1) {
                                var obj = {};
                                obj.src = "/img/title/"+t.value+".png";
                                obj.name = t[lang];
                                self.titlelist.push(obj);
                            }
                            else if(t.type == 2) {
                                var obj = {};
                                obj.src = "/img/title/"+t[floor[i].ptcode].value+".png";
                                obj.name = t[floor[i].ptcode][lang];
                                self.titlelist.push(obj);
                                var obj2 = {};
                                obj2.src = "/img/title/"+t.value+".png";
                                obj2.name = t[lang];
                                self.titlelist.push(obj2);
                            }
                        }
                    }
                    loadTitle = true;
                    checkLoading();
                });
            }
        });

        function checkLoading() {
            if(loadTitle && loadTower) $("#loading").hide();
        }

        //signout
        function gsignLoad() {
            gapi.load('auth2', function() {
                gapi.auth2.init();
            });
        }
        
        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function() {
                console.log('User signed out.');
            });
            $("#logout").submit();
        }
        </script>
        <div th:insert="header :: header"></div>
        <div th:insert="footer :: footer"></div>
        <script src="/function/menu.js"></script>
    </body>
  </html>