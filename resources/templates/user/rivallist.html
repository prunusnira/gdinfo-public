<!-- /*****************************************************
 * GITADORA Info Server
 * Developed by Tae Jun Kang a.k.a Prunus Nira
 * (c) Nira 2016
 *
 * 1. This project is protected under GNU AGPL v3.0
 *    Please refer to LICENSE file on root
 * 2. Also, products and libraries used to implement
 *    this server are on USED-LIBRARIES file on root
 *****************************************************/ -->
 <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="google-signin-client_id"
      content="clientid.apps.googleusercontent.com">
    <link rel="icon" href="/favicon.ico">

    <script src="/function/language.js"></script>
	<script src="/function/language/rivallist.js"></script>
    <title>GITADORA Info</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom css -->
	<link href="/css/custom/header.css" rel="stylesheet">
	<link href="/css/custom/footer.css" rel="stylesheet">
	<link href="/css/custom/skillcolor.css" rel="stylesheet">
	<link href="/css/custom/skillcolor-rainbow.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- Google Adsense -->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({
			google_ad_client: "ca-pub-adsenseid",
			enable_page_level_ads: true
		});
	</script>
  </head>

  <body>
  	<section class="container" id="loading">
  		<h1>LOADING... Please wait</h1>
  	</section>
  	
  	<section class="container">
		<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-header">
						<h3>Rival List</h3>
					</div>
					<div class="card-body" id="rivalist">
						<div class="row">
							<div class='col-sm-6 col-12'>
								<h3><b>GuitarFreaks Rivals</b></h3>
								<div id="gf">
									<rival-row v-for="rv in grivalist" v-bind:rv="rv"></rival-row>
								</div>
							</div>
							
							<div class='col-sm-6 col-12'>
								<h3><b>DrumMania Rivals</b></h3>
								<div id="dm">
									<rival-row v-for="rv in drivalist" v-bind:rv="rv"></rival-row>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
  	</section>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="/js/jquery-3.3.1.min.js"></script>
	<script src="/js/vue.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/function/skillcolor.js"></script>
    <script src="/function/pageloader.js"></script>
    <script src="/function/overall.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=gsignLoad" async defer></script>
    <div style='display:none'>
		<form action='/logout' id='logout' method='post'>
		</form>
	</div>

	<template id='rival-template'>
		<div class='row'>
			<div class='col-12'>
				<a class='innerhref' v-bind:href="rv.proflink">
					{{ rv.name }} â“Ÿ
				</a>
			</div>
			<div class='col-6 blackandwhite dskill'>{{ rv.skill }}</div>
			<div class='col-6'>
				<a class='btn btn-primary' v-bind:href='rv.compbtn'>
					<span class='glyphicon glyphicon-random' aria-hidden='true'></span>
					{{ rv.comptxt }}
				</a>
				<a class='btn btn-primary' v-bind:href='rv.remove'>{{ rv.removetxt }}</a>
			</div>
		</div>
	</template>

	<script th:inline="javascript">
	Vue.component('rival-row', {
		template: '#rival-template',
		props: {
			rv: Object
		}
	});

	var id = /*[[${id}]]*/0;

	var vm = new Vue({
		el: '#rivalist',
		data: {
			grivalist: [],
			drivalist: []
		},
		created: function() {
			var self = this;
			$.ajax('/d/rivallist/'+id)
			.done(function(data) {
				var json = JSON.parse(data);

				if(json.gf.length == 0) {
					$("#gf").append(addEmpty());
				}
				else {
					for(var i = 0; i < json.gf.length; i++) {
						self.grivalist.push(updateRival(json.gf[i], 'gf'));
					}
				}
				if(json.dm.length == 0) {
					$("#dm").append(addEmpty());
				}
				else {
					for(var i = 0; i < json.dm.length; i++) {
						self.drivalist.push(updateRival(json.dm[i], 'dm'));
					}
				}

				$("#loading").hide();
			});
		},
		updated: function() {
			updateColor();
		}
	});

	function addEmpty() {
		var outerd = document.createElement('div');
		outerd.className = 'row';
		var innerd = document.createElement('div');
		innerd.className = 'col-12';
		var info = document.createElement('h3');
		info.textContent = txtRivalList.empty[lang];
		innerd.appendChild(info);
		outerd.appendChild(innerd);
		return outerd;
	}

	function updateRival(data, type) {
		var obj = {};
		obj.proflink = '/profile/'+data.id;
		obj.name = data.name;
		if(type == 'gf')
			obj.skill = data.gskill;
		else if(type == 'dm')
			obj.skill = data.dskill;
		obj.compbtn = '/comparison/'+data.id+'/'+type+'/1';
		obj.comptxt = txtRivalList.compare[lang];
		obj.remove = '/d/rivalrm/'+data.id+'/'+type;
		obj.removetxt = txtRivalList.remove[lang];

		return obj;
	}
	</script>
	<div th:insert="header :: header"></div>
	<div th:insert="footer :: footer"></div>
	<script src="/function/menu.js"></script>
  </body>
</html>
