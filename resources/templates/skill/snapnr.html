<!-- /*****************************************************
 * GITADORA Info Server
 * Developed by Tae Jun Kang a.k.a Prunus Nira
 * (c) Nira 2016
 *
 * 1. This project is protected under GNU AGPL v3.0
 *    Please refer to LICENSE file on root
 * 2. Also, products and libraries used to implement
 *    this server are on USED-LIBRARIES file on root
 *****************************************************/ -->
 <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="google-signin-client_id"
      content="google-signin-id.apps.googleusercontent.com">
    <link rel="icon" href="/favicon.ico">

    <script src="/function/language.js"></script>
	<script src="/function/language/skill.js"></script>
	<script src="/function/language/snapshot.js"></script>
    <title>GITADORA Info</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom css -->
	<link href="/css/custom/header.css" rel="stylesheet">
	<link href="/css/custom/footer.css" rel="stylesheet">
	<link href="/css/custom/table.css" rel="stylesheet">
	<link href="/css/custom/filter.css" rel="stylesheet">
	<link href="/css/custom/skill.css" rel="stylesheet">
	<link href="/css/custom/skillcolor.css" rel="stylesheet">
	<link href="/css/custom/skillcolor-rainbow.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- Google Adsense -->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({
			google_ad_client: "ca-pub-adsenseid",
			enable_page_level_ads: true
		});
	</script>
  </head>

  <body>
  	<section class="container" id="loading">
		<h1>LOADING... Please wait</h1>
  	</section>

	<section class="container">
	  	<div class="row">
		  	<div class="col-12">
				<div class="card">
					<div class="card-header">
						<h3>Skill Table</h3>
					</div>
					<div class="card-body" id="scrshotdiv">
						<span id='gtype' th:attr='data-gtype=${gtype}'></span>
						<div class='col-12 text-center'>
							<h4>Screenshot</h4>
						</div>
						<div class="col-12">
							<div style='width:100%;' class="btn-group btn-group-justified" role="group">
								<!--<a style="width:100%;" class="btn btn-warning" href="#no_div" v-bind:onclick="scrpage">
									{{ scrpagetxt }}
								</a>-->
								<a style="width:100%;" class="btn btn-warning" href="#no_div" th:onclick="|scrShot('#scrTable', '${id}_'+document.getElementById('gtype').dataset.gtype+'_all_${page}_'+getTimeScr()+'.jpg')|">
									{{ scrcurtxt }}
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
	   	</div>
		<div class="card" id='scrTable'>
			<div class="card-header">
				<div class="row" id="targetInfo">
					<div class="col-12 text-center">
						<h4><b>Snapshot Of
							<span th:if="${gtype}=='gf'">GuitarFreaks</span>
							<span th:if="${gtype}=='dm'">DrumMania</span><br/>
							<span>Skill by <span id="nameTop"></span></span>
						</b></h4>
					</div>
					<div class='col-6' style="text-align:center;">
						<b>Made by GITADORA.info</b>
					</div>
					<div class='col-6' style="text-align:center;">
						Saved Date: <span id="timeTop"></span>
					</div>
				</div>
			</div>
			<div class="card-body">
				<div class="card-title">
					<div class="col-12 skillupper">
						<div class="row blackandwhite text-center" id="statusBar">
							<div class='col-4'>
								{{ statLeftTitle }}<br/><span class='skill' v-html="statLeft"></span>
							</div>
							<div class='col-4'>
								{{ statMidTitle }}<br/>{{ statMid }}
							</div>
							<div class='col-4'>
								{{ statRightTitle }}<br/>{{ statRight }}
							</div>
						</div>
					</div>
				</div>
				<div class="card-text">
					<div class="row" id="targetTable">
						<div class="col-sm-6" id="halfTableLeft">
							<div class='row'>
								<div class='col-12 text-center'>
									<h2><b>HOT</b></h2>
								</div>
							</div>
							<div class='row'>
								<div class='col-12'>
									<div class='div-table' style="padding-bottom:100px;">
										<skill-table v-for="skill in hotList" v-bind:skill="skill" v-bind:key="skill.num"></skill-table>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6" id="halfTableRight">
							<div class='row'>
								<div class='col-12 text-center'>
									<h2><b>OTHER</b></h2>
								</div>
							</div>
							<div class='row'>
								<div class='col-12'>
									<div class='div-table'>
										<skill-table v-for="skill in otherList" v-bind:skill="skill" v-bind:key="skill.num"></skill-table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
  	</section>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="/js/jquery-3.3.1.min.js"></script>
	<script src="/js/vue.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/html2canvas.js"></script>
    <script src="/js/FileSaver.js"></script>
    <script src="/function/skillfilter.js"></script>
    <script src="/function/skillcolor.js"></script>
    <script src="/function/capture.js"></script>
    <script src="/function/filteranalyzer.js"></script>
    <script src="/function/rivalmanage.js"></script>
    <script src="/function/pageloader.js"></script>
    <script src="/function/pattern.js"></script>
    <script src="/function/version.js"></script>
    <script src="/function/time.js"></script>
    <script src="/function/towertitle.js"></script>
	<script src="/function/pager.js"></script>
    <script src="/function/overall.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=gsignLoad" async defer></script>
    <div style='display:none'>
		<form action='/logout' id='logout' method='post'>
		</form>
	</div>

	<template id="skill-template">
		<div class="div-table-row skilltable" style="border-bottom: 1px solid black;">
			<!-- 스킬색상 부분 -->
			<div class="div-table-cell" v-bind:style="skill.skillcolor"></div>
			<div class="div-table-cell" style="vertical-align:middle;">
				<!-- 번호 -->
				<span style="font-size:150%;">{{ skill.num }}</span>
			</div>
			<div class="div-table-cell text-center" style="padding:5px !important; margin:0px !important;">
				<!-- 재킷 및 패턴 -->
				<img style="width:100%; width:85px;" v-bind:src="skill.jacketurl" onerror="this.src='/img/music/empty.jpg'" /><br/>
				<img style="width:100%; width:85px;" v-bind:src="skill.pattern" /><br/>
				<span>{{ skill.level }}</span><br/>
				<span>{{ skill.version }}</span>
			</div>
			<!-- 패턴 정보 및 리절트 -->
			<div class='div-table-cell' style="vertical-align:middle">
				<!-- 음악 정보 -->
				<div class='row'>
					<div class='col-12 text-left' style='width:100%;'>
						<div style='display:table; table-layout:fixed; width:100%; white-space: nowrap;'>
							<a class='innerhref' v-bind:href="skill.musiclink" style='font-size: 125%; display:table-cell; overflow-x:hidden; text-overflow:ellipsis;'>
								{{ skill.musicname }}
							</a>
						</div>
					</div>
				</div>
				<!-- 스킬미터 -->
				<div class='row'>
					<div class='col-12 text-left' v-html="skill.meter"></div>
				</div>
				<!-- 기록정보 -->
				<div class='row'>
					<div class='col-12 text-left'>
						<span>
							<img class='skillrank-img' v-bind:src="skill.rankimg" />
							<span v-html="skill.fcimg"></span>
						</span>
					</div>
				</div>
				<div class='row'>
					<div class='col-12 text-left'>
						{{ skill.rate }}% / {{ skill.skill }}
					</div>
				</div>
			</div>
		</div>
	</template>

	<script th:inline="javascript">
	// Filter
	$("#verfilter").append(generateVerFilter(false));

	var bus = new Vue();
	var uid = /*[[${uid}]]*/0;
	var date = /*[[${date}]]*/'';
	var gtype = /*[[${gtype}]]*/'';
	
	Vue.component('skill-table', {
		template: '#skill-template',
		props: {
			skill: Object
		}
	});

	var vmScrshot = new Vue({
		el: '#scrshotdiv',
		data: {
			scrpage: 'checkScr()',
			scrpagetxt: txtSkill.scrshotp[lang],
			scrcurtxt: txtSkill.scrshot[lang]
		}
	});

	function checkScr() {
		/*if(ptype == 1000) {
			window.location.href = '/skillscr/1000/0/'+gtype+'/0/none';
		}
		else {
			var urlbase = window.location.href.split('/skill/')[1];
			window.location.href = '/skillscr/'+urlbase;
		}*/
	}

	var vmSkill = new Vue({
		el: '#targetTable',
		data: {
			hotList: [],
			otherList: [],
			sum1: 0,
			sum2: 0
		},
		methods: {
			sendSum: function() {
				bus.$emit('sendSum', this.sum1+'|'+this.sum2)
			}
		},
		created: function() {
			var self = this;

			$.ajax('/d/skill/snapshot/load/'+uid+'/'+date+'/'+gtype)
			.done(function(data) {
				var json = JSON.parse(data);

				var hsize = json.hot.length;
				if(json.hot.length > 25) hsize = 25;
				
				var osize = json.oth.length;
				if(json.oth.length > 25) osize = 25;
				
				if(json.hot.length > 0) {
					for(var i = 0; i < hsize; i++) {
						var cur = json.hot[i];
						var obj = generateTable(cur, i, 1);

						self.sum1 += obj.skill1;

						self.hotList.push(obj);
					}
				}
				if(json.oth.length > 0) {
					for(var i = 0; i < osize; i++) {
						var cur = json.oth[i];
						var obj = generateTable(cur, i, 2);

						self.sum2 += obj.skill2;

						self.otherList.push(obj);
					}
				}
				
				var towertitlesp = document.createElement("span");
				// 칭호 표시
				getTowerTitle(uid, function(result) {
					if(result != "") {
						var timg = document.createElement("img");
						timg.setAttribute("class", "towertitle35");
						timg.src = "/img/title/"+result+".png";
						towertitlesp.appendChild(timg);
					}
				});
				
				$("#nameTop").append(towertitlesp);
				$("#nameTop").append("<a class='innerhref' href='/profile/"+uid+"'>"+json.uname+"</a>");

				var year = json.date.substring(0, 4);
				var month = json.date.substring(4, 6);
				var day = json.date.substring(6, 8);
				
				$("#timeTop").append(year + "/" + month + "/" + day);
				
				self.sendSum();
			});
		},
		updated: function() {
			$("#loading").hide();
		}
	});

	var vmInfo = new Vue({
		el: '#statusBar',
		data: {
			statLeftTitle: '',
			statLeft: '',
			statMidTitle: '',
			statMid: '',
			statRightTitle: '',
			statRight: '',
			oldver: txtSkill.oldver[lang],
			sum1: '',
			sum2: ''
		},
		mounted: function() {
			var self = this;

			bus.$on('sendSum', function(value) {
				var sum = value.split('|');
				//this.sum1 = parseFloat(sum[0]).toFixed(2);
				//this.sum2 = parseFloat(sum[1]).toFixed(2);
				Vue.set(vmInfo.$data, 'sum1', parseFloat(sum[0]).toFixed(2));
				Vue.set(vmInfo.$data, 'sum2', parseFloat(sum[1]).toFixed(2));

				vmInfo.statMidTitle = "Hot Skill";
				vmInfo.statRightTitle = "Other Skill";
				vmInfo.statMid = vmInfo.sum1;
				vmInfo.statRight = vmInfo.sum2;
				vmInfo.statLeft = (parseFloat(vmInfo.sum1)+parseFloat(vmInfo.sum2)).toFixed(2);
				if(gtype == "gf") {
					self.statLeftTitle = "GF Skill";
				}
				else if(gtype == "dm") {
					self.statLeftTitle = "DM Skill";
				}
			});
			
			$.ajax('/d/getuserid/'+uid)
			.done(function(data) {
				var json = JSON.parse(data).mydata;

				if(gtype == "gf") {
					self.statLeftTitle = "GF Skill";
					self.statLeft = json.gskill;
				}
				else if(gtype == "dm") {
					self.statLeftTitle = "DM Skill";
					self.statLeft = json.dskill;
				}

				vmInfo.statMidTitle = "Hot Skill";
				vmInfo.statRightTitle = "Other Skill";
			});
		},
		updated: function() {
			updateColor();
		}
	});

	function generateTable(cur, i, side) {
		var obj = {};
		obj.num = i+1;
		obj.jacketurl = "/img/music/"+cur.mid+".jpg";
		obj.musiclink = "/music/"+cur.mid+"/"+uid;
		obj.musicname = cur.mname;
		obj.level = (cur.lv/100).toFixed(2);
		obj.version = GDVer[cur.version-1].sv;
		obj.meter = "";
		obj.rankimg = getRankImg(cur.rank);
		obj.skill1 = 0;
		obj.skill2 = 0;
		obj.pattern = getPatternImg600(cur.ptcode);

		if(cur.fc == "Y") {
			if(cur.rank != "EXC") {
				obj.fcimg = "<img class='fc-img' src='/img/rank/fc_600.png' />";
			}
			else {
				obj.fcimg = "<img class='fc-img' src='/img/rank/exc_600.png' />";
			}
		}
		else {
			obj.fcimg = "<img class='fc-img' src='/img/rank/cleared_600.png' />";
		}

		obj.rate = (cur.rate/100).toFixed(2);
		obj.skill = cur.skill;
		if(side == 0 || side == 1) {
			obj.skill1 += obj.skill;
		}
		else if(side == 2) {
			obj.skill2 += obj.skill;
		}
		obj.skill = obj.skill.toFixed(2);
		obj.skillcolor = "display: inline-block; width:10px !important; height:100%; "+skillTableColor(cur.rate*cur.level*20);

		var meter = cur.meter.split('');
		for(var k = 0; k < meter.length; k++) {
			if(meter[k] == "0") {
				if(side == 1 || side == 2) {
					var media = window.matchMedia("(max-width: 768px)");
					if(media.matches) {
						obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#81BEF7; float:left'>&nbsp;</div>";
					}
					else {
						obj.meter += "<div style='width:0.25vw; max-width:9px; background-color:#81BEF7; float:left'>&nbsp;</div>";
					}
					
				}
				else {
					obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#81BEF7; float:left'>&nbsp;</div>";
				}
			}
			else if(meter[k] == "1") {
				if(side == 1 || side == 2) {
					var media = window.matchMedia("(max-width: 768px)");
					if(media.matches) {
						obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#F3F781; float:left'>&nbsp;</div>";
					}
					else {
						obj.meter += "<div style='width:0.25vw; max-width:9px; background-color:#F3F781; float:left'>&nbsp;</div>";
					}
				}
				else {
					obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#F3F781; float:left'>&nbsp;</div>";
				}
				
			}
			else {
				if(side == 1 || side == 2) {
					var media = window.matchMedia("(max-width: 768px)");
					if(media.matches) {
						obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#848484; float:left'>&nbsp;</div>";
					}
					else {
						obj.meter += "<div style='width:0.25vw; max-width:9px; background-color:#848484; float:left'>&nbsp;</div>";
					}
					
				}
				else {
					obj.meter += "<div style='width:0.5vw; max-width:9px; background-color:#848484; float:left'>&nbsp;</div>";
				}
			}
		}

		return obj;
	}

	function getRankImg(rank) {
		var img = "";

		switch(rank) {
		case "E":
			img = "/img/rank/rank_e.png";
			break;
		case "D":
			img = "/img/rank/rank_d.png";
			break;
		case "C":
			img = "/img/rank/rank_c.png";
			break;
		case "B":
			img = "/img/rank/rank_b.png";
			break;
		case "A":
			img = "/img/rank/rank_a.png";
			break;
		case "S":
			img = "/img/rank/rank_s.png";
			break;
		case "SS":
		case "EXC":
			img = "/img/rank/rank_ss.png";
			break;
		}

		return img;
	}
	</script>
	<div th:insert="header :: header"></div>
	<div th:insert="footer :: footer"></div>
	<script src="/function/menu.js"></script>
  </body>
</html>
