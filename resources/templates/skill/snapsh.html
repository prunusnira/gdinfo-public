<!-- /*****************************************************
 * GITADORA Info Server
 * Developed by Tae Jun Kang a.k.a Prunus Nira
 * (c) Nira 2016
 *
 * 1. This project is protected under GNU AGPL v3.0
 *    Please refer to LICENSE file on root
 * 2. Also, products and libraries used to implement
 *    this server are on USED-LIBRARIES file on root
 *****************************************************/ -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="google-signin-client_id"
      content="clientid.apps.googleusercontent.com">
    <link rel="icon" href="/favicon.ico">

    <script src="/function/language.js"></script>
	<script src="/function/language/skill.js"></script>
	<script src="/function/language/snapshot.js"></script>
    <title>GITADORA Info</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom css -->
	<link href="/css/custom/header.css" rel="stylesheet">
	<link href="/css/custom/footer.css" rel="stylesheet">
	<link href="/css/custom/table.css" rel="stylesheet">
	<link href="/css/custom/skill.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- Google Adsense -->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({
			google_ad_client: "ca-pub-adsenseid",
			enable_page_level_ads: true
		});
	</script>
  </head>

  <body>
  	<section class="container" id="loading">
		<h1>LOADING... Please wait</h1>
  	</section>
  	
  	<section class="container">
	  	<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-header">
						<h3>Skill <script>document.write(txtSkill.scrtitle[lang]);</script></h3>
					</div>
					<div class="card-body">
						<div class="col-12">
							<script>document.write(txtSkill.scrdesc[lang]);</script>
						</div>
						<div class="col-12 btn-group" id="prevlink">
							<a style="width:100%;" class="btn btn-warning" href="#no_div" onclick="scrShotM()">
								<script>document.write(txtSkill.scrshot[lang]);</script>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-12">
				<div class="card" id='scrTable'>
					<div class="card-header">
						<div class="row" id="targetInfo">
							<div class="col-12 text-center">
								<h4><b>Snapshot Of
									<span th:if="${gtype}=='gf'">GuitarFreaks</span>
									<span th:if="${gtype}=='dm'">DrumMania</span><br/>
									<span>Skill by <span id="nameTop"></span></span>
								</b></h4>
								<b>Made by GITADORA.info</b>
							</div>
						</div>
					</div>
					<div class="card-body">
						<div class="card-title">
							<div class="col-12">
								<div class="row blackandwhite text-center skillupper" id="statusBar">
									<div class='col-4'>
										{{ statLeftTitle }}<br/><span style="color:white" class='skill' v-html="statLeft"></span>
									</div>
									<div class='col-4'>
										{{ statMidTitle }}<br/>{{ statMid }}
									</div>
									<div class='col-4'>
										{{ statRightTitle }}<br/>{{ statRight }}
									</div>
								</div>
							</div>
						</div>
						<div class="card-text">
							<div class="row" id="targetTable">
								<div class="col-12 scrhalf" id='halfTableLeft'>
									<div class='row'>
										<div class='col-12 text-center'>
											<h4><b><span th:if="${gtype} == 'gf'">GF </span><span th:if="${gtype} == 'dm'">DM </span>HOT SKILLS by <span id="nameTop1"></span></b></h4>
											Made by GITADORA.Info
										</div>
									</div>
									<div class='row'>
										<skill-table v-for="skill in hotList" v-bind:skill="skill" v-bind:key="skill.num"></skill-table>
									</div>
								</div>
								<div class="col-12 scrhalf" id='halfTableRight'>
									<div class='row'>
										<div class='col-12 text-center'>
											<h4><b><span th:if="${gtype} == 'gf'">GF </span><span th:if="${gtype} == 'dm'">DM </span>OTHER SKILLS by <span id="nameTop2"></span></b></h4>
											Made by GITADORA.Info
										</div>
									</div>
									<div class='row'>
										<skill-table v-for="skill in otherList" v-bind:skill="skill" v-bind:key="skill.num"></skill-table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
  	</section>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="/js/jquery-3.3.1.min.js"></script>
	<script src="/js/vue.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/html2canvas.js"></script>
    <script src="/js/FileSaver.js"></script>
    <script src="/function/skillfilter.js"></script>
    <script src="/function/skillcolor.js"></script>
    <script src="/function/capture.js"></script>
    <script src="/function/pattern.js"></script>
    <script src="/function/version.js"></script>
    <script src="/function/time.js"></script>
    <script src="/function/towertitle.js"></script>
	<script src="/function/pager.js"></script>
    <script src="/function/overall.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=gsignLoad" async defer></script>
    <div style='display:none'>
		<form action='/logout' id='logout' method='post'>
		</form>
	</div>

	<template id="skill-template">
		<div class='col-4 col-md-3 skillupper' style='width: 100%;'>
			<div class='row'>
				<div class='col-12' style='padding:0 !important; margin:0px !important;'>
					<div class='text-center'><b>{{ skill.num }}</b></div>
					<div v-bind:style="skill.skillcolor"></div>
				</div>
			</div>
			<div class='row'>
				<div class='col-3' style='padding:0 !important; margin:0px !important;'>
					<img style='width:100%;' v-bind:src="skill.jacketurl" onerror="this.src='/img/music/empty.jpg'" /><br/>
				</div>
				<div class='col-4 text-center' style='padding:0 !important; margin:0px !important;'>
					<img class='skillrank-img' v-bind:src="skill.rankimg" />
					<span v-html="skill.fcimg"></span>
					<img style='width:100%;' v-bind:src="skill.pattern" />
				</div>
				<div class='col-5 text-center' style='font-size:110%; padding:0 !important; margin:0px !important;'>
					{{ skill.level }}<br/>{{ skill.rate }}%<br/>{{ skill.skill }}
				</div>
			</div>
			<div class='row'>
				<div class='col' style='padding:1px !important; margin:0px !important; white-space: nowrap; overflow:hidden; text-overflow:ellipsis;'>
					<b style='word-break: break-all;'>{{ skill.musicname }}</b>
				</div>
			</div>
		</div>
	</template>

	<script th:inline="javascript">
	// Filter
	$("#verfilter").append(generateVerFilter(false));

	var bus = new Vue();
	var uid = /*[[${uid}]]*/0;
	var date = /*[[${date}]]*/'';
	var gtype = /*[[${gtype}]]*/'';

	Vue.component('skill-table', {
		template: '#skill-template',
		props: {
			skill: Object
		}
	});

	var vmPrev = new Vue({
		el: '#prevlink',
		data: {
			prev: ''
		},
		created: function() {
			var urlbase = window.location.href.split('/skillscr')[1];
			this.prev = '/skill'+urlbase;
		}
	});

	var vmSkill = new Vue({
		el: '#targetTable',
		data: {
			hotList: [],
			otherList: [],
			sum1: 0,
			sum2: 0
		},
		methods: {
			sendSum: function() {
				bus.$emit('sendSum', this.sum1+'|'+this.sum2)
			}
		},
		created: function() {
			var self = this;

			$.ajax('/d/skill/snapshot/load/'+uid+'/'+date+'/'+gtype)
			.done(function(data) {
				var json = JSON.parse(data);

				if(json.hot.length > 0) {
					for(var i = 0; i < json.hot.length; i++) {
						var cur = json.hot[i];
						var obj = generateTable(cur, i, 1);

						self.sum1 += obj.skill1;

						self.hotList.push(obj);
					}
				}
				if(json.oth.length > 0) {
					for(var i = 0; i < json.oth.length; i++) {
						var cur = json.oth[i];
						var obj = generateTable(cur, i, 2);

						self.sum2 += obj.skill2;

						self.otherList.push(obj);
					}
				}
				
				// 칭호 표시
				getTowerTitle(uid, function(result) {
					if(result != "") {
						var timg = document.createElement("img");
						timg.className = 'towertitle35';
						timg.src = "/img/title/"+result+".png";
						$("#nameTop").prepend(timg);
						$("#nameTop1").prepend(timg.cloneNode(true));
						$("#nameTop2").prepend(timg.cloneNode(true));
					}
				});
				
				$("#nameTop").append("<a class='innerhref' href='/profile/"+uid+"'>"+json.uname+"</a>");
				$("#nameTop1").append("<a class='innerhref' href='/profile/"+uid+"'>"+json.uname+"</a>");
				$("#nameTop2").append("<a class='innerhref' href='/profile/"+uid+"'>"+json.uname+"</a>");

				var year = json.date.substring(0, 4);
				var month = json.date.substring(4, 6);
				var day = json.date.substring(6, 8);

				$("#timeTop").append(year + "/" + month + "/" + day);
				
				self.sendSum();
			});
		},
		updated: function() {
			$("#loading").hide();
		}
	});

	var vmInfo = new Vue({
		el: '#statusBar',
		data: {
			statLeftTitle: '',
			statLeft: '',
			statMidTitle: '',
			statMid: '',
			statRightTitle: '',
			statRight: '',
			oldver: txtSkill.oldver[lang],
			sum1: '',
			sum2: ''
		},
		mounted: function() {
			var self = this;

			bus.$on('sendSum', function(value) {
				var sum = value.split('|');
				//this.sum1 = parseFloat(sum[0]).toFixed(2);
				//this.sum2 = parseFloat(sum[1]).toFixed(2);
				Vue.set(vmInfo.$data, 'sum1', parseFloat(sum[0]).toFixed(2));
				Vue.set(vmInfo.$data, 'sum2', parseFloat(sum[1]).toFixed(2));

				vmInfo.statMidTitle = "Hot Skill";
				vmInfo.statRightTitle = "Other Skill";
				vmInfo.statMid = vmInfo.sum1;
				vmInfo.statRight = vmInfo.sum2;
				vmInfo.statLeft = (parseFloat(vmInfo.sum1)+parseFloat(vmInfo.sum2)).toFixed(2);
				if(gtype == "gf") {
					self.statLeftTitle = "GF Skill";
				}
				else if(gtype == "dm") {
					self.statLeftTitle = "DM Skill";
				}
				updateColor();
			});

			$.ajax('/d/getuserid/'+uid)
			.done(function(data) {
				var json = JSON.parse(data).mydata;

				if(gtype == "gf") {
					self.statLeftTitle = "GF Skill";
					self.statLeft = json.gskill;
				}
				else if(gtype == "dm") {
					self.statLeftTitle = "DM Skill";
					self.statLeft = json.dskill;
				}

				vmInfo.statMidTitle = "Hot Skill";
				vmInfo.statRightTitle = "Other Skill";
			});
		},
		updated: function() {
			updateColor();
		}
	});

	function generateTable(cur, i, side) {
		var obj = {};
		obj.num = i+1;
		obj.jacketurl = "/img/music/"+cur.mid+".jpg";
		obj.musiclink = "/music/"+cur.mid+"/"+uid;
		obj.musicname = cur.mname;
		obj.level = (cur.lv/100).toFixed(2);
		obj.version = GDVer[cur.version-1].sv;
		obj.rankimg = getRankImg(cur.rank);
		obj.skill1 = 0;
		obj.skill2 = 0;
		obj.pattern = getPatternImg600(cur.ptcode);

		if(cur.fc == "Y") {
			if(cur.rank != "EXC") {
				obj.fcimg = "<img style='width:100%' src='/img/rank/fc_600.png' />";
				}
			else {
				obj.fcimg = "<img style='width:100%' src='/img/rank/exc_600.png' />";
			}
		}
		else {
			obj.fcimg = "<img style='width:100%' src='/img/rank/cleared_600.png' />";
		}

		obj.rate = (cur.rate/100).toFixed(2);
		obj.skill = cur.skill;
		if(side == 1) {
			obj.skill1 += obj.skill;
		}
		else if(side == 2) {
			obj.skill2 += obj.skill;
		}
		obj.skill = obj.skill.toFixed(2);
		obj.skillcolor = "width:100%; height:10px; "+skillTableColorFlat(cur.rate*cur.level*20);

		return obj;
	}

	function getRankImg(rank) {
		var img = "";

		switch(rank) {
		case "E":
			img = "/img/rank/rank_e.png";
			break;
		case "D":
			img = "/img/rank/rank_d.png";
			break;
		case "C":
			img = "/img/rank/rank_c.png";
			break;
		case "B":
			img = "/img/rank/rank_b.png";
			break;
		case "A":
			img = "/img/rank/rank_a.png";
			break;
		case "S":
			img = "/img/rank/rank_s.png";
			break;
		case "SS":
		case "EXC":
			img = "/img/rank/rank_ss.png";
			break;
		}

		return img;
	}

	function scrShotM() {
		if(ptype == 2 || ptype == 5 || ptype == 6 || ptype == 8) {
			scrShot('#halfTableLeft', id+'_'+gtype+'_hot_'+page+'_'+getTimeScr()+'.jpg');
			scrShot('#halfTableRight', id+'_'+gtype+'_other_'+page+'_'+getTimeScr()+'.jpg');
		}
		else {
			scrShot('#scrTable', id+'_'+gtype+'_all_'+page+'_'+getTimeScr()+'.jpg');
		}
	}
	</script>
	<div th:insert="header :: header"></div>
	<div th:insert="footer :: footer"></div>
	<script src="/function/menu.js"></script>
  </body>
</html>
