<!-- /*****************************************************
 * GITADORA Info Server
 * Developed by Tae Jun Kang a.k.a Prunus Nira
 * (c) Nira 2016
 *
 * 1. This project is protected under GNU AGPL v3.0
 *    Please refer to LICENSE file on root
 * 2. Also, products and libraries used to implement
 *    this server are on USED-LIBRARIES file on root
 *****************************************************/ -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="google-signin-client_id"
            content="clientid.apps.googleusercontent.com">
        <link rel="icon" href="/favicon.ico">

        <script src="/function/language.js"></script>
        <script src="/function/language/snapshot.js"></script>
        <title>GITADORA Info</title>

        <!-- Bootstrap core CSS -->
        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <!-- Custom css -->
        <link href="/css/custom/header.css" rel="stylesheet">
        <link href="/css/custom/footer.css" rel="stylesheet">
        <link href="/css/custom/table.css" rel="stylesheet">
        <link href="/css/custom/filter.css" rel="stylesheet">
        <link href="/css/custom/skill.css" rel="stylesheet">
        <link href="/css/custom/skillcolor.css" rel="stylesheet">
        <link href="/css/custom/skillcolor-rainbow.css" rel="stylesheet">

        <!-- Google Adsense -->
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-adsenseid",
                enable_page_level_ads: true
            });
        </script>
    </head>

    <body>
        <section class="container" id="loading">
            <h1>LOADING... Please wait</h1>
        </section>

        <section class="container">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3>Snapshot List</h3>
                        </div>
                        <div class="card-body" id="snaplist">
                            <div class="row">
                                <div class="col-12">
                                    {{ desc1 }}<br/>
                                    <b style="color:coral">{{ desc2 }}</b><br/>
                                    {{ desc3 }}<br/><br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3>GuitarFreaks</h3>
                                        </div>
                                        <div class="card-body" v-html="gfsnap">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3>DrumMania</h3>
                                        </div>
                                        <div class="card-body" v-html="dmsnap">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="/js/jquery-3.3.1.min.js"></script>
        <script src="/js/vue.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/function/overall.js"></script>
        <script src="https://apis.google.com/js/platform.js?onload=gsignLoad" async defer></script>
        <div style='display:none'>
            <form action='/logout' id='logout' method='post'>
            </form>
        </div>

        <script th:inline="javascript">
            var uid = /*[[${uid}]]*/0;

            var vmSnapshot = new Vue({
                el: "#snaplist",
                data: {
                    desc1: txtSnapshot.desc1[lang],
                    desc2: txtSnapshot.desc2[lang],
                    desc3: txtSnapshot.desc3[lang],
                    gfsnap: "",
                    dmsnap: ""
                },
                created: function() {
                    var self = this;
                    
                    // 파일 리스트 가져오기
                    $.ajax("/d/skill/snapshot/list/"+uid)
                    .done(function(data) {
                        var json = JSON.parse(data);
                        var list = json.list;

                        var gflist = new Array();
                        var dmlist = new Array();

                        // '.'과 '_'으로 split
                        for(var i = 0; i < list.length; i++) {
                            var c = list[i].split('.')[0].split('_');
                            if(c[1] == "gf") gflist.push(c[0]);
                            else if(c[1] == "dm") dmlist.push(c[0]);
                        }

                        gflist.sort(function(a, b) {
                            if(a > b) return 1;
                            else if(b > a) return -1;
                            else return 0;
                        });

                        dmlist.sort(function(a, b) {
                            if(a > b) return 1;
                            else if(b > a) return -1;
                            else return 0;
                        });

                        for(var i = 0; i < gflist.length; i++) {
                            self.gfsnap += generateLink(gflist[i], 'gf');
                        }

                        for(var i = 0; i < dmlist.length; i++) {
                            self.dmsnap += generateLink(dmlist[i], 'dm');
                        }
                        
                        if(gflist.length == 0) {
                            self.gfsnap = "LIST IS EMPTY";
                        }

                        if(dmlist.length == 0) {
                            self.dmsnap = "LIST IS EMPTY";
                        }
                    });
                },
                updated: function() {
                    $("#loading").hide();
                }
            });

            function generateLink(date, gtype) {
                var html = "<div class='row'><div class='col-md-5'>"+
                        date+"</div><div class='col-md-7 btn-group'>"+
                        "<a class='btn btn-primary' href='/skill/snapshot/view/nr/"+uid+"/"+date+"/"+gtype+"'>"+txtSnapshot.btnN[lang]+"</a>"+
                        "<a class='btn btn-primary' href='/skill/snapshot/view/sh/"+uid+"/"+date+"/"+gtype+"'>"+txtSnapshot.btnS[lang]+"</a>"+
                        "<a charset='UTF-8' class='btn btn-primary' href='/file/snapshot/"+uid+"/"+date+"_"+gtype+".json'>"+txtSnapshot.btnD[lang]+"</a>"+
                        "</div>";
                return html;
            }
        </script>
        <div th:insert="header :: header"></div>
        <div th:insert="footer :: footer"></div>
    </body>
</html>